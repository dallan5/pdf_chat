<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat with Assistant</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}" />
    <style>
        /* New styles added */
        .main-container {
            display: flex;
        }

        .pdf-container,
        .chat-container {
            flex: 1;
            padding: 10px;
        }

        .pdf-object {
            width: 100%;
            height: 400px; /* Adjust height as needed */
        }
    </style>
</head>

<body>
    <div class="main-container">
        <!-- PDF Container on the Left -->
        <div class="pdf-wrapper">
            <object class="pdf-object" data="{{ url_for('static', filename='pdf/test_book.pdf') }}" type="application/pdf">
                <p>It seems your browser doesn't support viewing PDFs. You can <a href="{{ url_for('static', filename='pdf/test_book.pdf') }}">download the PDF here</a> instead.</p>
            </object>
        </div>

        <!-- Chat Container on the Right -->
        <div class="chat-container">
            <img src="{{ url_for('static', filename='tutor.png') }}" class="icon" />
            <h3>Chat Window</h3>
            <div id="chat-window">
                {% for message in messages %}
                    {% if loop.index > 1 %}
                        <div class="{{ message.role }}">{{ message.content }}</div>
                    {% endif %}
                {% endfor %}
            </div>

            <form action="/" method="post">
                <input type="text" name="query" placeholder="Type your message..." required />
                <input type="submit" value="Send" />
            </form>
        </div>
    </div>

    <!-- Start of JavaScript -->
    <script>
        document.querySelector("form").addEventListener("submit", function(event){
            event.preventDefault(); // Stop the form from submitting

            // Collect data from the form
            const formData = new FormData(event.target);

            // Convert formData to JSON
            const formObject = {};
            formData.forEach((value, key) => {
                formObject[key] = value;
            });

            // Update chat window with user's message.
            const chatWindow = document.getElementById("chat-window");
            const userMessage = document.createElement("div");
            userMessage.className = "user";
            userMessage.textContent = formObject.query;
            chatWindow.appendChild(userMessage);

            // Send form data using fetch
            fetch("/", {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formObject)
            })
            .then(response => response.json())
            .then(data => {
                // Update chat window with OpenAI's response.
                const aiMessage = document.createElement("div");
                aiMessage.className = data.role || "assistant";
                aiMessage.textContent = data.message;
                chatWindow.appendChild(aiMessage);

                // Scroll to the bottom of the chat window
                chatWindow.scrollTop = chatWindow.scrollHeight;
            })
            .catch(error => {
                console.error("Error:", error);
            });
        });
    </script>
    <!-- End of JavaScript -->

</body>

</html>
